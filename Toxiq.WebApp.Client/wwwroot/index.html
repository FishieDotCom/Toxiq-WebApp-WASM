<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <base href="/" />
    <link href="css/toxiq-styles.css" rel="stylesheet" />
    <link href="css/post-card.css" rel="stylesheet" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link href="Toxiq.WebApp.Client.styles.css" rel="stylesheet" />

    <!-- Telegram WebApp Script - Load before our scripts -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body>
    <div id="app">
        <div style="
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #0e0e0e;
            color: white;
            font-family: 'Roboto', sans-serif;
            gap: 20px;
        ">
            <div style="
                width: 80px;
                height: 80px;
                background: linear-gradient(135deg, #d600aa, #190649);
                border-radius: 16px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 32px;
                font-weight: 600;
                color: white;
                animation: pulse 2s ease-in-out infinite alternate;
            ">
                T
            </div>
            <div style="text-align: center;">
                <h2 style="margin: 0; font-size: 24px; font-weight: 600;">Loading Toxiq</h2>
                <p style="margin: 8px 0 0 0; color: #acacac; font-size: 14px;">Where Cool Kids Hangout</p>
        </div>
        <style>
            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }

                100% {
                    transform: rotate(360deg);
                }
            }

            @keyframes pulse {
                0% {
                    transform: scale(1);
                }

                100% {
                    transform: scale(1.05);
                }
            }
        </style>
    </div>
        </div>
    <div id="blazor-error-ui" style="
        background: #b32121;
        color: white;
        padding: 1rem;
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        display: none;
        text-align: center;
    ">
        An unhandled error has occurred.
        <a href="" class="reload" style="color: white; margin-left: 1rem;">Reload</a>
        <a class="dismiss" style="color: white; margin-left: 1rem; cursor: pointer;">ðŸ—™</a>
    </div>

    <script src="_framework/blazor.webassembly.js"></script>

    <!-- Telegram Authentication JavaScript -->
    <script src="js/telegram-auth.js"></script>

    <script>
        // Platform detection for responsive behavior
        window.toxiqPlatform = {
            detect: function () {
                return {
                    isTelegramMiniApp: window.Telegram && window.Telegram.WebApp,
                    isDesktop: window.innerWidth >= 1024,
                    isMobile: window.innerWidth < 768,
                    userAgent: navigator.userAgent,
                    viewportWidth: window.innerWidth,
                    viewportHeight: window.innerHeight,
                    hasTouch: 'ontouchstart' in window || navigator.maxTouchPoints > 0
                };
            }
        };

        // Enhanced platform detection that returns the object directly
        window.getPlatformInfo = function () {
            return window.toxiqPlatform.detect();
        };

        // Legacy token functions for compatibility
        window.setToken = function (token) {
            try {
                localStorage.setItem('auth_token', token);
                console.log('Token set in localStorage');
            } catch (error) {
                console.error('Error setting token:', error);
            }
        };

        window.getToken = function () {
            try {
                const token = localStorage.getItem('auth_token');
                return token || '';
            } catch (error) {
                console.error('Error getting token:', error);
                return '';
            }
        };

        // Performance optimization: preload critical resources
        window.addEventListener('load', function () {
            // Remove loading indicator after app loads
            setTimeout(() => {
                const loadingDiv = document.querySelector('#app > div:first-child');
                if (loadingDiv && loadingDiv.style.display !== 'none') {
                    loadingDiv.style.opacity = '0';
                    loadingDiv.style.transition = 'opacity 0.3s ease';
                    setTimeout(() => loadingDiv.remove(), 300);
                }
            }, 1000);
        });

        // Handle error UI
        document.addEventListener('DOMContentLoaded', function () {
            const errorUI = document.getElementById('blazor-error-ui');
            const dismissBtn = errorUI.querySelector('.dismiss');

            dismissBtn?.addEventListener('click', function () {
                errorUI.style.display = 'none';
            });
        });

        // Auto-detection and logging for Telegram WebApp
        document.addEventListener('DOMContentLoaded', function () {
            console.log('Toxiq WebApp starting...');

            if (window.Telegram && window.Telegram.WebApp) {
                console.log('Running in Telegram WebApp');
                console.log('Telegram WebApp version:', window.Telegram.WebApp.version);
                console.log('Platform:', window.Telegram.WebApp.platform);

                // Configure Telegram WebApp
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand();

                // Apply theme
                if (window.Telegram.WebApp.colorScheme === 'dark') {
                    document.documentElement.setAttribute('data-theme', 'dark');
                }
            } else {
                console.log('Running in standard web browser');
            }
        });
    </script>
</body>
</html>